import{b}from"./chunk-D2VIWSGU.js";import{a as f}from"./chunk-XC5NQH5T.js";import{j as g,l as v}from"./chunk-GQYAU5FR.js";import{$a as s,Fa as a,Ka as u,ab as p,bb as h,lc as d,rb as m}from"./chunk-SU5VR5TY.js";import"./chunk-EQDQRRRY.js";var y=class c{constructor(r,e,t,i){this.route=r;this.router=e;this.authService=t;this.toastService=i}ngOnInit(){let r=this.route.snapshot.queryParamMap.get("code"),e=this.route.snapshot.queryParamMap.get("state");if(r&&e){this.processAuth(r,e);return}let t=window.location.search.substring(1),i=window.location.hash.includes("?")?window.location.hash.substring(window.location.hash.indexOf("?")+1):"",o=this.parseQueryString(t);!o.code&&i&&(o=this.parseQueryString(i));let n=o.code,l=o.state,S=o.error;n&&l?this.processAuth(n,l):this.handleError(S)}processAuth(r,e){this.authService.handleAuthCallback(r,e).subscribe({next:t=>{if(t){let i=localStorage.getItem("auth_redirect_url")||"/dashboard";localStorage.removeItem("auth_redirect_url"),this.toastService.showSuccess("Login Successful",`Welcome, ${t.name||t.login}!`),setTimeout(()=>{this.router.navigateByUrl(i)},300)}else this.handleError()},error:t=>{console.error("Auth callback error:",t),this.handleError(t.message)}})}handleError(r){this.toastService.showError("Authentication Failed",r||"Unable to complete login. Please try again."),this.router.navigate(["/login"])}parseQueryString(r){let e={},t=r.split("&");for(let i of t){let[o,n]=i.split("=");o&&n&&(e[decodeURIComponent(o)]=decodeURIComponent(n.replace(/\+/g," ")))}return e}static \u0275fac=function(e){return new(e||c)(a(g),a(v),a(b),a(f))};static \u0275cmp=u({type:c,selectors:[["app-auth-callback"]],decls:5,vars:0,consts:[[1,"auth-callback-container"],[1,"auth-spinner"],[1,"fas","fa-circle-notch","fa-spin"]],template:function(e,t){e&1&&(s(0,"div",0)(1,"div",1),h(2,"i",2),s(3,"p"),m(4,"Processing authentication..."),p()()())},dependencies:[d],styles:[".auth-callback-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh;background-color:var(--color-bg-secondary)}.auth-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:2rem;background-color:var(--color-bg-primary);border-radius:8px;box-shadow:0 4px 12px #0000001a}i[_ngcontent-%COMP%]{font-size:3rem;color:var(--color-primary);margin-bottom:1rem}p[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:1rem}"]})};export{y as AuthCallbackComponent};
