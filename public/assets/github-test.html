<!DOCTYPE html>
<html>

<head>
    <title>GitHub OAuth Test</title>
</head>

<body>
    <h1>GitHub OAuth Test</h1>
    <button id="loginButton">Login with GitHub</button>
    <pre id="output" style="border: 1px solid #ccc; padding: 10px; margin-top: 20px;"></pre>

    <script>
        // Log function to display on page
        function log(message) {
            document.getElementById('output').textContent += message + '\n';
            console.log(message);
        }

        // Parse query parameters
        function getQueryParams() {
            const params = {};
            const queryString = window.location.search.substring(1);
            const pairs = queryString.split('&');

            for (let i = 0; i < pairs.length; i++) {
                const pair = pairs[i].split('=');
                params[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');
            }

            return params;
        }

        // Check for callback parameters
        const params = getQueryParams();
        if (params.code && params.state) {
            log('Received callback with code: ' + params.code);
            log('State: ' + params.state);

            // Verify state matches
            const savedState = localStorage.getItem('github_test_state');
            log('Saved state: ' + savedState);

            if (savedState === params.state) {
                log('State verification successful!');
            } else {
                log('State verification failed!');
            }
        }

        // Button click handler
        document.getElementById('loginButton').addEventListener('click', function () {
            const clientId = 'Ov23liUghCDZkiBqtV6L';
            const redirectUri = encodeURIComponent(window.location.href);
            const scope = 'read:user user:email';
            const state = Math.random().toString(36).substring(2, 15);

            log('Generated state: ' + state);
            localStorage.setItem('github_test_state', state);

            const authUrl = `https://github.com/login/oauth/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scope}&state=${state}`;
            log('Redirecting to: ' + authUrl);

            window.location.href = authUrl;
        });
    </script>
</body>

</html>