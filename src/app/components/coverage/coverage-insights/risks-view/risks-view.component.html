<div class="risks-view" [class.dark-theme]="isDarkTheme">
    <div class="risks-header">
        <h3>High Risk Classes</h3>
        <p class="risks-desc">
            Classes identified as potential risks based on size, complexity, and low coverage
        </p>
    </div>

    <!-- Empty state when no high risk classes -->
    <div class="risks-empty" *ngIf="highRiskClasses.length === 0">
        <div class="empty-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <h3>No High Risk Classes Detected</h3>
        <p>All of your classes have acceptable coverage levels or are not complex enough to be considered risks.</p>
    </div>

    <ng-container *ngIf="highRiskClasses.length > 0">
        <!-- Search and filter -->
        <div class="search-filter">
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" class="search-input" [(ngModel)]="searchTerm" (ngModelChange)="sortRiskClasses()"
                    placeholder="Search classes...">
                <button class="clear-btn" *ngIf="searchTerm" (click)="clearSearch()">
                    <i class="fas fa-times-circle"></i>
                </button>
            </div>
            <div class="result-count" *ngIf="highRiskClasses.length > 0">
                Showing {{filteredCount}} of {{highRiskClasses.length}} classes
            </div>
        </div>

        <!-- Risk content -->
        <div class="risk-content">
            <!-- Risk table -->
            <div class="risk-table-wrapper" [class.with-details]="selectedRiskClass">
                <table class="risk-table">
                    <thead>
                        <tr>
                            <th class="sortable" (click)="sortRiskClasses('name')">
                                Class
                                <i class="fas" [ngClass]="getSortIconClass('name')"></i>
                            </th>
                            <th class="sortable" (click)="sortRiskClasses('coverage')">
                                Coverage
                                <i class="fas" [ngClass]="getSortIconClass('coverage')"></i>
                            </th>
                            <th class="sortable" (click)="sortRiskClasses('lines')">
                                Lines
                                <i class="fas" [ngClass]="getSortIconClass('lines')"></i>
                            </th>
                            <th class="sortable" (click)="sortRiskClasses('riskScore')">
                                Risk
                                <i class="fas" [ngClass]="getSortIconClass('riskScore')"></i>
                            </th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let cls of sortedRiskClasses"
                            [class.selected]="selectedRiskClass?.name === cls.name" (click)="selectRiskClass(cls)">
                            <td class="class-name" [title]="cls.name">
                                <div class="class-name-wrapper">
                                    <i class="fas fa-file-code"></i>
                                    <span>{{cls.name | classNameOnly}}</span>
                                </div>
                            </td>
                            <td>
                                <div class="coverage-badge" [ngClass]="getCoverageClass(cls.coverage)">
                                    {{cls.coverage.toFixed(1)}}%
                                </div>
                            </td>
                            <td>{{cls.linesValid}}</td>
                            <td>
                                <div class="risk-indicator">
                                    <div class="risk-bar" [ngStyle]="{'width.%': cls.riskScore}"></div>
                                    <div class="risk-value">{{cls.riskScore.toFixed(0)}}</div>
                                </div>
                            </td>
                            <td>
                                <button class="btn-icon" title="View Details"
                                    (click)="selectRiskClass(cls); $event.stopPropagation();">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Class details -->
            <div class="class-details" *ngIf="selectedRiskClass">
                <div class="details-header">
                    <h4>{{ selectedRiskClass.name }}</h4>
                    <button class="close-btn" (click)="closeRiskClassDetails()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="details-row">
                    <div class="detail-metric coverage">
                        <div class="metric-title">Line Coverage</div>
                        <div class="metric-value" [ngClass]="getCoverageClass(selectedRiskClass.coverage)">
                            {{selectedRiskClass.coverage.toFixed(1)}}%
                        </div>
                    </div>

                    <div class="detail-metric lines">
                        <div class="metric-title">Lines of Code</div>
                        <div class="metric-value">{{selectedRiskClass.linesValid}}</div>
                    </div>

                    <div class="detail-metric risk">
                        <div class="metric-title">Risk Score</div>
                        <div class="metric-value">{{selectedRiskClass.riskScore.toFixed(1)}}</div>
                    </div>
                </div>

                <div class="details-row risk-factors">
                    <h5><i class="fas fa-exclamation-triangle"></i> Risk Assessment</h5>

                    <div class="risk-factor-grid">
                        <div class="risk-factor-card" [ngClass]="getRiskLevel(selectedRiskClass.linesValid, 50, 200)">
                            <div class="risk-factor-value">{{selectedRiskClass.linesValid}}</div>
                            <div class="risk-factor-label">Lines of Code</div>
                            <div class="risk-badge">
                                {{getRiskLevelText(selectedRiskClass.linesValid, 50, 200)}}
                            </div>
                        </div>

                        <div class="risk-factor-card"
                            [ngClass]="getRiskLevel(100 - selectedRiskClass.coverage, 10, 50)">
                            <div class="risk-factor-value">{{(100 - selectedRiskClass.coverage).toFixed(1)}}%</div>
                            <div class="risk-factor-label">Coverage Gap</div>
                            <div class="risk-badge">
                                {{getRiskLevelText(100 - selectedRiskClass.coverage, 10, 50)}}
                            </div>
                        </div>

                        <div class="risk-factor-card" *ngIf="selectedRiskClass.branchCoverage !== undefined"
                            [ngClass]="getRiskLevel(100 - selectedRiskClass.branchCoverage, 10, 50)">
                            <div class="risk-factor-value">{{(100 - selectedRiskClass.branchCoverage).toFixed(1)}}%
                            </div>
                            <div class="risk-factor-label">Branch Coverage Gap</div>
                            <div class="risk-badge">
                                {{getRiskLevelText(100 - selectedRiskClass.branchCoverage, 10, 50)}}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="details-row risk-recommendations">
                    <h5><i class="fas fa-lightbulb"></i> Recommendations</h5>

                    <div class="recommendations-list">
                        <div class="recommendation-item" *ngIf="selectedRiskClass.coverage < 50">
                            <div class="recommendation-icon">
                                <i class="fas fa-clipboard-check"></i>
                            </div>
                            <div class="recommendation-text">Focus on adding basic test coverage for core functionality
                                first</div>
                        </div>

                        <div class="recommendation-item" *ngIf="selectedRiskClass.linesValid > 300">
                            <div class="recommendation-icon">
                                <i class="fas fa-code-branch"></i>
                            </div>
                            <div class="recommendation-text">Consider breaking this class into smaller, more focused
                                components</div>
                        </div>

                        <div class="recommendation-item"
                            *ngIf="selectedRiskClass.branchCoverage && selectedRiskClass.branchCoverage < 50">
                            <div class="recommendation-icon">
                                <i class="fas fa-sitemap"></i>
                            </div>
                            <div class="recommendation-text">Add tests for conditional logic branches</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>
</div>