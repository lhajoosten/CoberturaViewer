<div class="insights-container card" [class.dark-theme]="isDarkTheme" [class.fullscreen]="isFullscreen">
  <!-- Header Toolbar -->
  <div class="toolbar">
    <h2><i class="fas fa-lightbulb"></i> Coverage Insights</h2>
    <div class="toolbar-actions">
      <!-- Threshold Settings -->
      <app-threshold-settings *ngIf="coverageData" [thresholds]="thresholds" [showSettings]="showThresholdSettings"
        (thresholdsUpdated)="updateThresholds($event)" (toggleSettings)="toggleThresholdSettings()">
      </app-threshold-settings>

      <!-- Export Button -->
      <button class="toolbar-btn" (click)="exportInsights()" [disabled]="!coverageData"
        title="Export insights as markdown">
        <i class="fas fa-download"></i>
      </button>

      <!-- Fullscreen Button -->
      <button class="toolbar-btn" (click)="toggleFullscreen()"
        [title]="isFullscreen ? 'Exit fullscreen (ESC)' : 'Enter fullscreen'">
        <i class="fas" [ngClass]="isFullscreen ? 'fa-compress-alt' : 'fa-expand-alt'"></i>
      </button>
    </div>
  </div>

  <!-- Fullscreen ESC Hint -->
  <div class="fullscreen-indicator" *ngIf="isFullscreen">
    <span>Press ESC to exit</span>
  </div>

  <!-- Main Content -->
  <div class="insights-content" *ngIf="coverageData">
    <!-- View Tabs -->
    <div class="view-tabs">
      <button *ngFor="let tab of tabs" class="tab-button" [class.active]="activeView === tab.id"
        [class.hidden]="tab.id === 'risks' && highRiskClasses.length === 0" (click)="setActiveView(tab.id)">
        <i class="fas" [ngClass]="getTabIcon(tab.id)"></i>
        <span>{{tab.label}}</span>
      </button>
    </div>

    <!-- Views -->
    <ng-container [ngSwitch]="activeView">
      <app-metrics-view *ngSwitchCase="'metrics'" [coverageData]="coverageData" [thresholds]="thresholds">
      </app-metrics-view>

      <app-insights-view *ngSwitchCase="'insights'" [insights]="insights" [isDarkTheme]="isDarkTheme">
      </app-insights-view>

      <app-risks-view *ngSwitchCase="'risks'" [highRiskClasses]="highRiskClasses" [thresholds]="thresholds"
        [isDarkTheme]="isDarkTheme">
      </app-risks-view>

      <app-distribution-view *ngSwitchCase="'distribution'" [coverageData]="coverageData" [thresholds]="thresholds"
        [isDarkTheme]="isDarkTheme">
      </app-distribution-view>

      <app-recommendations-view *ngSwitchCase="'recommendations'" [recommendations]="recommendations"
        [isDarkTheme]="isDarkTheme">
      </app-recommendations-view>
    </ng-container>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!coverageData">
    <div class="empty-icon">
      <i class="fas fa-chart-pie"></i>
    </div>
    <h2>No Coverage Data Available</h2>
    <p class="empty-hint">Upload a Cobertura XML file to see insights and recommendations.</p>
    <button class="btn-primary empty-action" (click)="navigateToUpload()">
      <i class="fas fa-upload"></i> Upload Coverage File
    </button>
  </div>
</div>