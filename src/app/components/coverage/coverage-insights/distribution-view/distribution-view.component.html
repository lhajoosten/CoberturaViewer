<div class="distribution-view" [class.dark-theme]="isDarkTheme">

    <!-- Class Distribution Section -->
    <div class="distribution-section">
        <div class="section-header">
            <h3><i class="fas fa-chart-pie"></i> Coverage Distribution by Class</h3>
            <p class="section-desc">How many classes fall into each coverage category</p>
        </div>

        <div class="distribution-chart-container">
            <!-- Pie Chart -->
            <div class="pie-chart">
                <svg viewBox="0 0 100 100">
                    <ng-container *ngFor="let segment of coverageDistribution; let i = index">
                        <path *ngIf="segment.value > 0" [attr.d]="createPieSegment(i, coverageDistribution)"
                            [attr.fill]="segment.color" stroke="#fff" stroke-width="0.5"
                            [attr.data-value]="segment.value" class="pie-segment">
                        </path>
                    </ng-container>

                    <!-- Center text showing total classes -->
                    <g class="pie-center">
                        <text x="50" y="45" text-anchor="middle" class="pie-total-label">Classes</text>
                        <text x="50" y="60" text-anchor="middle" class="pie-total">
                            {{getTotalClasses()}}
                        </text>
                    </g>
                </svg>
            </div>

            <!-- Legend -->
            <div class="chart-legend">
                <div class="legend-item" *ngFor="let item of coverageDistribution">
                    <div class="legend-color" [style.backgroundColor]="item.color"></div>
                    <div class="legend-info">
                        <div class="legend-name">{{item.name}}</div>
                        <div class="legend-value">
                            <span class="value">{{item.value}}</span>
                            <span class="percentage">({{item.percentage.toFixed(1)}}%)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Line Coverage Distribution -->
    <div class="distribution-section">
        <div class="section-header">
            <h3><i class="fas fa-align-left"></i> Line Coverage Distribution</h3>
            <p class="section-desc">Distribution of covered vs uncovered code lines</p>
        </div>

        <div class="bar-chart-container">
            <!-- Stacked Bar -->
            <div class="stacked-bar">
                <div *ngFor="let segment of lineDistribution" class="bar-segment" [style.width.%]="segment.percentage"
                    [style.background-color]="segment.color"
                    [attr.data-label]="segment.name + ': ' + segment.value + ' lines'">
                    <span class="bar-label" *ngIf="segment.percentage > 8">
                        {{segment.percentage.toFixed(0)}}%
                    </span>
                </div>
            </div>

            <!-- Bar Legend -->
            <div class="bar-legend">
                <div class="legend-item" *ngFor="let item of lineDistribution">
                    <div class="legend-color" [style.backgroundColor]="item.color"></div>
                    <div class="legend-info">
                        <div class="legend-name">{{item.name}}</div>
                        <div class="legend-value">
                            <span class="value">{{item.value.toLocaleString()}}</span>
                            <span class="percentage">({{item.percentage.toFixed(1)}}%)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Package Coverage Distribution -->
    <div class="distribution-section">
        <div class="section-header">
            <h3><i class="fas fa-boxes"></i> Coverage by Package</h3>
            <p class="section-desc">Coverage percentage for each package in the project</p>
        </div>

        <div class="package-distribution">
            <div class="package-item" *ngFor="let pkg of packageDistribution">
                <div class="package-name" [title]="pkg.name">
                    {{pkg.name}}
                </div>
                <div class="package-bar-container">
                    <div class="package-bar" [style.width.%]="pkg.percentage"
                        [ngClass]="getCoverageClass(pkg.percentage)">
                        {{pkg.percentage.toFixed(1)}}%
                    </div>
                </div>
            </div>

            <!-- Empty state for no packages -->
            <div class="empty-packages" *ngIf="packageDistribution.length === 0">
                <i class="fas fa-box-open"></i>
                <p>No package information available in this coverage report</p>
            </div>
        </div>
    </div>
</div>