<div class="coverage-treemap-container" [class.dark-theme]="isDarkTheme">
    <!-- Controls Component -->
    <app-treemap-controls [minCoverage]="minCoverage" (minCoverageChange)="onMinCoverageChange($event)"
        [selectedPackage]="selectedPackage" (selectedPackageChange)="onSelectedPackageChange($event)"
        [groupSmallNodes]="groupSmallNodes" (groupSmallNodesChange)="onGroupSmallNodesChange($event)"
        [searchTerm]="searchTerm" (searchTermChange)="onSearchTermChange($event)" [showFilters]="showFilters"
        [showLabels]="showLabels" (showLabelsChange)="onShowLabelsChange($event)" [colorMode]="colorMode"
        (colorModeChange)="onColorModeChange($event)" [minLines]="minLines" (minLinesChange)="onMinLinesChange($event)"
        [sortBy]="sortBy" (sortByChange)="onSortByChange($event)" [hasActiveFilters]="hasActiveFilters"
        [packageList]="packageList" (clearFilters)="onClearAllFilters()" (toggleFilters)="onToggleFilters($event)">
    </app-treemap-controls>

    <!-- Loading indicator -->
    <div class="loading-overlay" *ngIf="isLoading">
        <div class="spinner"></div>
        <div class="loading-text">Loading coverage data...</div>
    </div>

    <!-- Main Visualization -->
    <div class="visualization-container">
        <app-treemap-visualization *ngIf="filteredData && filteredData.length > 0" [data]="filteredData"
            [isDarkTheme]="isDarkTheme" [showLabels]="showLabels" [groupSmallNodes]="groupSmallNodes"
            [colorMode]="colorMode" [coverageRanges]="coverageRanges" (nodeSelected)="onNodeSelected($event)">
        </app-treemap-visualization>

        <!-- No data message -->
        <div class="no-data-message" *ngIf="!hasData && !isLoading">
            <div class="message-content">
                <h3>No coverage data available</h3>
                <p>No code coverage data has been loaded. Run your tests with coverage enabled to see results here.</p>
            </div>
        </div>
    </div>

    <!-- Details panel (shown when a node is selected) -->
    <app-treemap-details *ngIf="selectedNode" [@slideInOut] [selectedNode]="selectedNode"
        [similarClasses]="similarClasses" (closeDetails)="selectedNode = null"
        (selectSimilarNode)="onNodeSelected($event)">
    </app-treemap-details>
</div>